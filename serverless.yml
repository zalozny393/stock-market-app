service: stock-market-app
frameworkVersion: '3'

plugins:
  - serverless-appsync-plugin
  - serverless-appsync-simulator
  - serverless-offline
  - serverless-python-requirements

useDotenv: true

provider:
  name: aws
  runtime: python3.9
  environment:
    LOCAL_DEBUG: ${param:local_debug, 'false'}

custom:
  pythonRequirements:
    dockerizePip: true
    useStaticCache: false
    slim: true
    layer: true
  appSync:
    name: ${self:service}-${sls:stage}
    authenticationType: API_KEY
    mappingTemplates:
      - type: Query
        field: getStockInfo
        dataSource: getStockInfo
        request: false
        response: false
    dataSources:
      - type: AWS_LAMBDA
        name: getStockInfo
        config:
          functionName: getStockInfo
  appsync-simulator:
    apiKey: 'da2-fakeApiId123456'

	
package:
  individually: false
  include:
    - '!./**'
    - './src/**'
  exclude:
    - '**'

functions:
  getStockInfo:
    handler: src/handler.get_stock_info
    layers:
      - Ref: PythonRequirementsLambdaLayer
